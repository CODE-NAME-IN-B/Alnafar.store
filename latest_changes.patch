From dd6df79b1d37ece1475de0b683dbd5b7d8450a1b Mon Sep 17 00:00:00 2001
From: CODE-NAME-IN-B <code.name.in.b@gmail.com>
Date: Sun, 2 Nov 2025 22:11:17 +0200
Subject: [PATCH 1/2] =?UTF-8?q?Fix:=20=D8=A5=D8=B5=D9=84=D8=A7=D8=AD=20?=
 =?UTF-8?q?=D8=AE=D8=B7=D8=A3=20ReferenceError:=20invoiceNumber=20is=20not?=
 =?UTF-8?q?=20defined?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- إضافة state لرقم الفاتورة مع قيمة مؤقتة للعرض
- تحديث رقم الفاتورة بالرقم الفعلي من الخادم بعد الإنشاء
- حل مشكلة الخطأ JavaScript الذي كان يسبب تعطل التطبيق
---
 frontend/src/Invoice.jsx | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/frontend/src/Invoice.jsx b/frontend/src/Invoice.jsx
index 30573a2..0635821 100644
--- a/frontend/src/Invoice.jsx
+++ b/frontend/src/Invoice.jsx
@@ -15,6 +15,13 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
   })
   const [discount, setDiscount] = useState(0)
   const [isProcessing, setIsProcessing] = useState(false)
+  
+  // إنشاء رقم فاتورة مؤقت للعرض
+  const [invoiceNumber, setInvoiceNumber] = useState(() => {
+    const today = new Date().toISOString().split('T')[0].replace(/-/g, '')
+    const randomSuffix = Math.floor(Math.random() * 1000).toString().padStart(3, '0')
+    return `${today}-${randomSuffix}`
+  })
 
   // سيتم إنشاء رقم الفاتورة تلقائياً في الخادم
   const currentDate = new Date().toLocaleDateString('ar-LY', {
@@ -294,6 +301,10 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
 
       const response = await api.post('/invoices', invoiceData)
       if (response.data?.success) {
+        // تحديث رقم الفاتورة بالرقم الفعلي من الخادم
+        if (response.data.invoice?.invoice_number) {
+          setInvoiceNumber(response.data.invoice.invoice_number)
+        }
         onSuccess(response.data)
       }
     } catch (error) {
-- 
2.51.2


From e5c3f5545b126e269d53eb4bcf45bb85528e06eb Mon Sep 17 00:00:00 2001
From: CODE-NAME-IN-B <code.name.in.b@gmail.com>
Date: Sun, 2 Nov 2025 22:26:42 +0200
Subject: [PATCH 2/2] =?UTF-8?q?=E2=9C=85=20=D8=A7=D9=84=D8=AD=D9=84=20?=
 =?UTF-8?q?=D8=A7=D9=84=D8=A3=D9=81=D8=B6=D9=84:=20=D8=A7=D8=B3=D8=AA?=
 =?UTF-8?q?=D8=B9=D8=A7=D8=AF=D8=A9=20=D8=A7=D9=84=D9=86=D8=B3=D8=AE=D8=A9?=
 =?UTF-8?q?=20=D8=A7=D9=84=D9=85=D9=8F=D8=B5=D9=84=D8=AD=D8=A9=20=D9=85?=
 =?UTF-8?q?=D9=86=20Git=20+=20=D8=A5=D8=B2=D8=A7=D9=84=D8=A9=20=D8=A7?=
 =?UTF-8?q?=D9=84=D8=B4=D8=B9=D8=A7=D8=B1=20=D9=86=D9=87=D8=A7=D8=A6=D9=8A?=
 =?UTF-8?q?=D8=A7=D9=8B=20+=20=D8=A5=D8=B5=D9=84=D8=A7=D8=AD=20socket.io-c?=
 =?UTF-8?q?lient?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 ...ceError-invoiceNumber-is-not-defined.patch |  49 ++++++
 frontend/package-lock.json                    | 140 +++++++++++++++++-
 frontend/package.json                         |   3 +-
 frontend/src/Invoice.jsx                      |   3 -
 4 files changed, 189 insertions(+), 6 deletions(-)
 create mode 100644 0001-Fix-ReferenceError-invoiceNumber-is-not-defined.patch

diff --git a/0001-Fix-ReferenceError-invoiceNumber-is-not-defined.patch b/0001-Fix-ReferenceError-invoiceNumber-is-not-defined.patch
new file mode 100644
index 0000000..d27fc34
--- /dev/null
+++ b/0001-Fix-ReferenceError-invoiceNumber-is-not-defined.patch
@@ -0,0 +1,49 @@
+From dd6df79b1d37ece1475de0b683dbd5b7d8450a1b Mon Sep 17 00:00:00 2001
+From: CODE-NAME-IN-B <code.name.in.b@gmail.com>
+Date: Sun, 2 Nov 2025 22:11:17 +0200
+Subject: [PATCH] =?UTF-8?q?Fix:=20=D8=A5=D8=B5=D9=84=D8=A7=D8=AD=20=D8=AE?=
+ =?UTF-8?q?=D8=B7=D8=A3=20ReferenceError:=20invoiceNumber=20is=20not=20def?=
+ =?UTF-8?q?ined?=
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+- إضافة state لرقم الفاتورة مع قيمة مؤقتة للعرض
+- تحديث رقم الفاتورة بالرقم الفعلي من الخادم بعد الإنشاء
+- حل مشكلة الخطأ JavaScript الذي كان يسبب تعطل التطبيق
+---
+ frontend/src/Invoice.jsx | 11 +++++++++++
+ 1 file changed, 11 insertions(+)
+
+diff --git a/frontend/src/Invoice.jsx b/frontend/src/Invoice.jsx
+index 30573a2..0635821 100644
+--- a/frontend/src/Invoice.jsx
++++ b/frontend/src/Invoice.jsx
+@@ -15,6 +15,13 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
+   })
+   const [discount, setDiscount] = useState(0)
+   const [isProcessing, setIsProcessing] = useState(false)
++  
++  // إنشاء رقم فاتورة مؤقت للعرض
++  const [invoiceNumber, setInvoiceNumber] = useState(() => {
++    const today = new Date().toISOString().split('T')[0].replace(/-/g, '')
++    const randomSuffix = Math.floor(Math.random() * 1000).toString().padStart(3, '0')
++    return `${today}-${randomSuffix}`
++  })
+ 
+   // سيتم إنشاء رقم الفاتورة تلقائياً في الخادم
+   const currentDate = new Date().toLocaleDateString('ar-LY', {
+@@ -294,6 +301,10 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
+ 
+       const response = await api.post('/invoices', invoiceData)
+       if (response.data?.success) {
++        // تحديث رقم الفاتورة بالرقم الفعلي من الخادم
++        if (response.data.invoice?.invoice_number) {
++          setInvoiceNumber(response.data.invoice.invoice_number)
++        }
+         onSuccess(response.data)
+       }
+     } catch (error) {
+-- 
+2.51.2
+
diff --git a/frontend/package-lock.json b/frontend/package-lock.json
index 5fdace1..f3cd43b 100644
--- a/frontend/package-lock.json
+++ b/frontend/package-lock.json
@@ -9,7 +9,8 @@
       "version": "1.0.0",
       "dependencies": {
         "react": "^18.3.1",
-        "react-dom": "^18.3.1"
+        "react-dom": "^18.3.1",
+        "socket.io-client": "^4.8.1"
       },
       "devDependencies": {
         "@types/react": "^18.3.3",
@@ -1140,6 +1141,12 @@
         "win32"
       ]
     },
+    "node_modules/@socket.io/component-emitter": {
+      "version": "3.1.2",
+      "resolved": "https://registry.npmjs.org/@socket.io/component-emitter/-/component-emitter-3.1.2.tgz",
+      "integrity": "sha512-9BCxFwvbGg/RsZK9tjXd8s4UcwR0MWeFQ1XEKIQVVvAGJyINdrqKMcTRyLoK8Rse1GjzLV9cwjWV1olXRWEXVA==",
+      "license": "MIT"
+    },
     "node_modules/@types/babel__core": {
       "version": "7.20.5",
       "resolved": "https://registry.npmjs.org/@types/babel__core/-/babel__core-7.20.5.tgz",
@@ -1616,6 +1623,45 @@
       "dev": true,
       "license": "MIT"
     },
+    "node_modules/engine.io-client": {
+      "version": "6.6.3",
+      "resolved": "https://registry.npmjs.org/engine.io-client/-/engine.io-client-6.6.3.tgz",
+      "integrity": "sha512-T0iLjnyNWahNyv/lcjS2y4oE358tVS/SYQNxYXGAJ9/GLgH4VCvOQ/mhTjqU88mLZCQgiG8RIegFHYCdVC+j5w==",
+      "license": "MIT",
+      "dependencies": {
+        "@socket.io/component-emitter": "~3.1.0",
+        "debug": "~4.3.1",
+        "engine.io-parser": "~5.2.1",
+        "ws": "~8.17.1",
+        "xmlhttprequest-ssl": "~2.1.1"
+      }
+    },
+    "node_modules/engine.io-client/node_modules/debug": {
+      "version": "4.3.7",
+      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
+      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
+      "license": "MIT",
+      "dependencies": {
+        "ms": "^2.1.3"
+      },
+      "engines": {
+        "node": ">=6.0"
+      },
+      "peerDependenciesMeta": {
+        "supports-color": {
+          "optional": true
+        }
+      }
+    },
+    "node_modules/engine.io-parser": {
+      "version": "5.2.3",
+      "resolved": "https://registry.npmjs.org/engine.io-parser/-/engine.io-parser-5.2.3.tgz",
+      "integrity": "sha512-HqD3yTBfnBxIrbnM1DoD6Pcq8NECnh8d4As1Qgh0z5Gg3jRRIqijury0CL3ghu/edArpUYiYqQiDUQBIs4np3Q==",
+      "license": "MIT",
+      "engines": {
+        "node": ">=10.0.0"
+      }
+    },
     "node_modules/esbuild": {
       "version": "0.21.5",
       "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.21.5.tgz",
@@ -2065,7 +2111,6 @@
       "version": "2.1.3",
       "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
       "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
-      "dev": true,
       "license": "MIT"
     },
     "node_modules/mz": {
@@ -2631,6 +2676,68 @@
         "url": "https://github.com/sponsors/isaacs"
       }
     },
+    "node_modules/socket.io-client": {
+      "version": "4.8.1",
+      "resolved": "https://registry.npmjs.org/socket.io-client/-/socket.io-client-4.8.1.tgz",
+      "integrity": "sha512-hJVXfu3E28NmzGk8o1sHhN3om52tRvwYeidbj7xKy2eIIse5IoKX3USlS6Tqt3BHAtflLIkCQBkzVrEEfWUyYQ==",
+      "license": "MIT",
+      "dependencies": {
+        "@socket.io/component-emitter": "~3.1.0",
+        "debug": "~4.3.2",
+        "engine.io-client": "~6.6.1",
+        "socket.io-parser": "~4.2.4"
+      },
+      "engines": {
+        "node": ">=10.0.0"
+      }
+    },
+    "node_modules/socket.io-client/node_modules/debug": {
+      "version": "4.3.7",
+      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
+      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
+      "license": "MIT",
+      "dependencies": {
+        "ms": "^2.1.3"
+      },
+      "engines": {
+        "node": ">=6.0"
+      },
+      "peerDependenciesMeta": {
+        "supports-color": {
+          "optional": true
+        }
+      }
+    },
+    "node_modules/socket.io-parser": {
+      "version": "4.2.4",
+      "resolved": "https://registry.npmjs.org/socket.io-parser/-/socket.io-parser-4.2.4.tgz",
+      "integrity": "sha512-/GbIKmo8ioc+NIWIhwdecY0ge+qVBSMdgxGygevmdHj24bsfgtCmcUUcQ5ZzcylGFHsN3k4HB4Cgkl96KVnuew==",
+      "license": "MIT",
+      "dependencies": {
+        "@socket.io/component-emitter": "~3.1.0",
+        "debug": "~4.3.1"
+      },
+      "engines": {
+        "node": ">=10.0.0"
+      }
+    },
+    "node_modules/socket.io-parser/node_modules/debug": {
+      "version": "4.3.7",
+      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
+      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
+      "license": "MIT",
+      "dependencies": {
+        "ms": "^2.1.3"
+      },
+      "engines": {
+        "node": ">=6.0"
+      },
+      "peerDependenciesMeta": {
+        "supports-color": {
+          "optional": true
+        }
+      }
+    },
     "node_modules/source-map-js": {
       "version": "1.2.1",
       "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
@@ -3075,6 +3182,35 @@
         "node": ">=8"
       }
     },
+    "node_modules/ws": {
+      "version": "8.17.1",
+      "resolved": "https://registry.npmjs.org/ws/-/ws-8.17.1.tgz",
+      "integrity": "sha512-6XQFvXTkbfUOZOKKILFG1PDK2NDQs4azKQl26T0YS5CxqWLgXajbPZ+h4gZekJyRqFU8pvnbAbbs/3TgRPy+GQ==",
+      "license": "MIT",
+      "engines": {
+        "node": ">=10.0.0"
+      },
+      "peerDependencies": {
+        "bufferutil": "^4.0.1",
+        "utf-8-validate": ">=5.0.2"
+      },
+      "peerDependenciesMeta": {
+        "bufferutil": {
+          "optional": true
+        },
+        "utf-8-validate": {
+          "optional": true
+        }
+      }
+    },
+    "node_modules/xmlhttprequest-ssl": {
+      "version": "2.1.2",
+      "resolved": "https://registry.npmjs.org/xmlhttprequest-ssl/-/xmlhttprequest-ssl-2.1.2.tgz",
+      "integrity": "sha512-TEU+nJVUUnA4CYJFLvK5X9AOeH4KvDvhIfm0vV1GaQRtchnG0hgK5p8hw/xjv8cunWYCsiPCSDzObPyhEwq3KQ==",
+      "engines": {
+        "node": ">=0.4.0"
+      }
+    },
     "node_modules/yallist": {
       "version": "3.1.1",
       "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",
diff --git a/frontend/package.json b/frontend/package.json
index ee112cc..cf04232 100644
--- a/frontend/package.json
+++ b/frontend/package.json
@@ -10,7 +10,8 @@
   },
   "dependencies": {
     "react": "^18.3.1",
-    "react-dom": "^18.3.1"
+    "react-dom": "^18.3.1",
+    "socket.io-client": "^4.8.1"
   },
   "devDependencies": {
     "@types/react": "^18.3.3",
diff --git a/frontend/src/Invoice.jsx b/frontend/src/Invoice.jsx
index 0635821..f217a5c 100644
--- a/frontend/src/Invoice.jsx
+++ b/frontend/src/Invoice.jsx
@@ -1,6 +1,5 @@
 import React, { useState } from 'react'
 import { api } from './api'
-import logo from '../assites/logo.png'
 
 function currency(num) {
   return new Intl.NumberFormat('ar-LY', { style: 'currency', currency: 'LYD' }).format(num)
@@ -96,7 +95,6 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
             padding: 1mm 1.5mm;
             background: #fff;
           }
-          img.logo { display:block; margin: 0 auto 0.1mm; width: 50%; max-width: 120px; image-rendering: auto; filter: contrast(1.2) brightness(1.1); }
           .store-name-ar { 
             font-size: ${titleSize}; 
             font-weight: bold; 
@@ -197,7 +195,6 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
       </head>
       <body>
         <div class="receipt">
-          <img class="logo" src="${logo}" alt="logo" />
           ${showStoreInfo && storeName ? `<div class="store-name-ar">${storeName}</div>` : ''}
           ${showStoreInfo && storeNameEn ? `<div class="subtitle">${storeNameEn}</div>` : ''}
           <div class="title">${headerText}</div>
-- 
2.51.2


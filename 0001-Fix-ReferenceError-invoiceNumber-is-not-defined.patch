From dd6df79b1d37ece1475de0b683dbd5b7d8450a1b Mon Sep 17 00:00:00 2001
From: CODE-NAME-IN-B <code.name.in.b@gmail.com>
Date: Sun, 2 Nov 2025 22:11:17 +0200
Subject: [PATCH] =?UTF-8?q?Fix:=20=D8=A5=D8=B5=D9=84=D8=A7=D8=AD=20=D8=AE?=
 =?UTF-8?q?=D8=B7=D8=A3=20ReferenceError:=20invoiceNumber=20is=20not=20def?=
 =?UTF-8?q?ined?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- إضافة state لرقم الفاتورة مع قيمة مؤقتة للعرض
- تحديث رقم الفاتورة بالرقم الفعلي من الخادم بعد الإنشاء
- حل مشكلة الخطأ JavaScript الذي كان يسبب تعطل التطبيق
---
 frontend/src/Invoice.jsx | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/frontend/src/Invoice.jsx b/frontend/src/Invoice.jsx
index 30573a2..0635821 100644
--- a/frontend/src/Invoice.jsx
+++ b/frontend/src/Invoice.jsx
@@ -15,6 +15,13 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
   })
   const [discount, setDiscount] = useState(0)
   const [isProcessing, setIsProcessing] = useState(false)
+  
+  // إنشاء رقم فاتورة مؤقت للعرض
+  const [invoiceNumber, setInvoiceNumber] = useState(() => {
+    const today = new Date().toISOString().split('T')[0].replace(/-/g, '')
+    const randomSuffix = Math.floor(Math.random() * 1000).toString().padStart(3, '0')
+    return `${today}-${randomSuffix}`
+  })
 
   // سيتم إنشاء رقم الفاتورة تلقائياً في الخادم
   const currentDate = new Date().toLocaleDateString('ar-LY', {
@@ -294,6 +301,10 @@ export default function Invoice({ cart, total, onClose, onSuccess }) {
 
       const response = await api.post('/invoices', invoiceData)
       if (response.data?.success) {
+        // تحديث رقم الفاتورة بالرقم الفعلي من الخادم
+        if (response.data.invoice?.invoice_number) {
+          setInvoiceNumber(response.data.invoice.invoice_number)
+        }
         onSuccess(response.data)
       }
     } catch (error) {
-- 
2.51.2

